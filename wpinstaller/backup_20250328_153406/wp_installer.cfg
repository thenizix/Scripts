#!/bin/bash
# CONFIGURAZIONE PRINCIPALE - MODIFICARE QUESTI VALORI
DOMAIN="localhost"                  # Dominio del sito
WP_DIR="/var/www/html/wordpress"    # Percorso installazione WordPress
SERVER_PORT="80"                    # Porta HTTP
ADMIN_EMAIL="admin@${DOMAIN}"       # Email amministratore
PHP_VERSION="8.3"                   # Versione PHP da utilizzare
ENV_MODE="local"                    # ModalitÃ : local/prod
SSL_TYPE="selfsigned"               # Tipo SSL: letsencrypt/selfsigned/none

# GENERAZIONE CREDENZIALI DATABASE (Automatica)
MYSQL_CREDS_FILE="/root/.wp_mysql_creds"
if [ ! -f "${MYSQL_CREDS_FILE}" ]; then
    MYSQL_ROOT_PASS=$(openssl rand -base64 24 | tr -dc 'a-zA-Z0-9!@#$%^&*()_+-=')
    MYSQL_WP_USER="wp_$(openssl rand -hex 3)"
    MYSQL_WP_PASS=$(openssl rand -base64 24 | tr -dc 'a-zA-Z0-9!@#$%^&*()_+-=')
    MYSQL_WP_DB="wp_$(openssl rand -hex 3)"
    
    # Salva le credenziali in modo sicuro
    cat > "${MYSQL_CREDS_FILE}" <<EOF
MYSQL_ROOT_PASS='${MYSQL_ROOT_PASS}'
MYSQL_WP_USER='${MYSQL_WP_USER}'
MYSQL_WP_PASS='${MYSQL_WP_PASS}'
MYSQL_WP_DB='${MYSQL_WP_DB}'
EOF
    chmod 600 "${MYSQL_CREDS_FILE}"
fi
source "${MYSQL_CREDS_FILE}"