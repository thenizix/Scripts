#!/bin/bash
# ****************************************************************************** #
#                                                                                #
#                                                         :::      ::::::::      #
#    wp_installer.cfg                                   :+:      :+:    :+:      #
#                                                     +:+ +:+         +:+        #
#    By: TheNizix <thenizix@protonmail.com>         +#+  +:+       +#+           #
#                                                 +#+#+#+#+#+   +#+              #
#    Created: 2025/03/25 15:00:00 by TheNizix          #+#    #+#                #
#    Updated: 2025/03/25 15:00:00 by TheNizix         ###   ######## Firenze     #
#                                                                                #
# ****************************************************************************** #

# ===================== CONFIGURAZIONE BASE =====================
DOMAIN="localhost"                      # Dominio (cambia in produzione)
ADMIN_EMAIL="admin@${DOMAIN}"           # Email per certificati/notifiche
PHP_VERSION="8.3"                       # Versione PHP (8.2|8.3)
WP_DIR="/var/www/html/wordpress"        # Path installazione WordPress

# ===================== IMPOSTAZIONI NGINX =====================
NGINX_USER="www-data"                   # Utente sotto cui gira Nginx
NGINX_WORKER_PROCESSES="auto"           # auto|numero_cpu (es: 4)
NGINX_WORKER_CONNECTIONS="1024"         # Connessioni concorrenti
NGINX_KEEPALIVE_TIMEOUT="65"            # Timeout connessioni (sec)
NGINX_CLIENT_MAX_BODY_SIZE="64M"        # Max upload size (64M per WordPress)

# ===================== IMPOSTAZIONI PHP-FPM =====================
PHP_MEMORY_LIMIT="256M"                 # Memoria massima PHP
PHP_MAX_EXECUTION_TIME="300"            # Timeout script (sec)
PHP_UPLOAD_MAX_FILESIZE="64M"           # Max dimensione upload
PHP_POST_MAX_SIZE="64M"                 # Max dimensione POST

# ===================== CONFIGURAZIONE DATABASE =====================
MYSQL_ROOT_PASS="Superbanana1"          # Password root MySQL (CAMBIALA!)
MYSQL_WP_USER="wpuser"                  # Utente database WordPress
MYSQL_WP_PASS="SecurePass123!"          # Password utente (CAMBIALA!)
MYSQL_WP_DB="wordpress"                 # Nome database

# ===================== IMPOSTAZIONI SSL =====================
SSL_COUNTRY="IT"                        # Codice paese (2 lettere)
SSL_STATE="Italy"                       # Stato/Regione
SSL_LOCALITY="Rome"                     # Citt√†
SSL_ORG="My Company"                    # Nome organizzazione
SSL_OU="IT Department"                  # Unit√† organizzativa
SSL_DAYS="365"                          # Validit√† certificato (giorni)
SSL_CIPHERS="TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384"

# ===================== FUNZIONI DI UTILIT√Ä =====================
validate_config() {
    echo -e "\033[1;33müîç Validazione configurazione...\033[0m"
    
    # Verifica se lo script √® eseguito come root
    [ "$(id -u)" -ne 0 ] && echo -e "\033[0;31m‚ùå Esegui come root/sudo!\033[0m" && exit 1
    
    # Controlla se la versione PHP √® installabile
    if ! apt-cache show php${PHP_VERSION}-fpm &>/dev/null; then
        echo -e "\033[0;31m‚ùå PHP ${PHP_VERSION} non disponibile!\033[0m"
        echo "Versioni disponibili:"
        apt-cache search php-fpm | grep -oP 'php\d\.\d-fpm' | sort -u
        exit 1
    fi
    
    # Verifica se Nginx √® installabile
    if ! apt-cache show nginx &>/dev/null; then
        echo -e "\033[0;31m‚ùå Nginx non disponibile nel repository!\033[0m"
        exit 1
    fi
    
    # Verifica password database
    if [ "${#MYSQL_ROOT_PASS}" -lt 12 ]; then
        echo -e "\033[0;31m‚ùå Password root MySQL troppo corta (min 12 caratteri)!\033[0m"
        exit 1
    fi
    
    if [ "${#MYSQL_WP_PASS}" -lt 8 ]; then
        echo -e "\033[0;31m‚ùå Password utente WP troppo corta (min 8 caratteri)!\033[0m"
        exit 1
    fi
    
    echo -e "\033[0;32m‚úÖ Configurazione validata\033[0m"
}